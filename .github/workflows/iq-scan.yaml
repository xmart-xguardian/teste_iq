name: IQ Server Scan

on:
  push:
    branches:
      - "**"

jobs:
  iq-scan:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Download Nexus IQ CLI
        run: |
          echo "ðŸ”½ Baixando Sonatype IQ CLI..."
          curl -L -o nexus-iq-cli.jar https://download.sonatype.com/clm/scanner/latest.jar
          echo "âœ… VersÃ£o do CLI:"
          java -jar nexus-iq-cli.jar --version 

      - name: Run IQ Server scan
        run: |
          echo "ðŸš€ Iniciando anÃ¡lise no Sonatype IQ Server..."
          java -jar nexus-iq-cli.jar \
            -s https://xmartsolutions.iqxp.ngrok.dev \
            -a Au6eYkY6:Q8BEoZcVGnmGm3iUZMMfEzQoB4gRud8wtdFD7eYvILLh \
            -i git_hub_actions_scans \
            -t build \
            -r iq-result.json \
            --fail-on-policy-warnings \
            .
          echo "âœ… AnÃ¡lise concluÃ­da. Resultado salvo em iq-result.json"

      - name: Upload IQ result JSON
        uses: actions/upload-artifact@v4
        with:
          name: iq-result
          path: iq-result.json
